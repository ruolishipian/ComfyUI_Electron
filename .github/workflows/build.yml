name: Electron è‡ªåŠ¨æ„å»º & æœ€å°åŒ–å‘å¸ƒ

# ğŸ‘‡ æ–°å¢ï¼šæˆäºˆå·¥ä½œæµä¿®æ”¹ä»“åº“å†…å®¹çš„æƒé™ï¼ˆè§£å†³403æŠ¥é”™çš„æ ¸å¿ƒï¼‰
permissions:
  contents: write

on:
  push:
    tags: [ 'v*' ]
  workflow_dispatch:

jobs:
  build-windows:
    runs-on: windows-latest
    steps:
      - name: æ‹‰å–ä»£ç ï¼ˆé€‚é…ä½ çš„ä»“åº“ï¼‰
        uses: actions/checkout@v4

      - name: å®‰è£…Node.js 18.xï¼ˆé€‚é…electron 28.xï¼‰
        uses: actions/setup-node@v4
        with:
          node-version: 18.x
          cache: 'npm'

      - name: å®‰è£…é¡¹ç›®ä¾èµ–ï¼ˆä½¿ç”¨å›½å†…é•œåƒåŠ é€Ÿï¼‰
        run: |
          npm config set registry https://registry.npmmirror.com
          npm install
        shell: pwsh

      - name: æ¸…ç†electron-builderç¼“å­˜ï¼ˆé¿å…æ—§é…ç½®å¹²æ‰°ï¼‰
        run: |
          Remove-Item -Recurse -Force $env:LOCALAPPDATA\electron-builder\Cache -ErrorAction SilentlyContinue
          Remove-Item -Recurse -Force node_modules\.cache\electron-builder -ErrorAction SilentlyContinue
        shell: pwsh
        continue-on-error: true

      - name: æ‰“åŒ…Windows x64ç‰ˆæœ¬ï¼ˆæœ€å°åŒ–æ‰“åŒ…ï¼Œç¦ç”¨electron-builderè‡ªåŠ¨å‘å¸ƒï¼‰
        run: npx electron-builder --win --x64 --config.asar=true --config.compression=maximum --publish never
        shell: pwsh

      - name: ä¸Šä¼ äº§ç‰©åˆ°Releases
        uses: softprops/action-gh-release@v2
        if: startsWith(github.ref, 'refs/tags/')
        with:
          files: dist/**
          draft: false
          prerelease: false
          # ğŸ‘‡ æ–°å¢ï¼šæ˜¾å¼ä½¿ç”¨å…·æœ‰å†™æƒé™çš„Tokenï¼ˆè™½ç„¶é»˜è®¤ä¼šç”¨ï¼Œä½†æ˜¾å¼å†™å‡ºæ›´ä¿é™©ï¼‰
          token: ${{ secrets.GITHUB_TOKEN }}

      # å…œåº•ï¼šä¸Šä¼ äº§ç‰©åˆ°Actionsï¼ˆå³ä½¿æ²¡æ‰“tagä¹Ÿèƒ½æ‰‹åŠ¨ä¸‹è½½ï¼‰
      - name: ä¸Šä¼ æœ€å°åŒ–æ‰“åŒ…äº§ç‰©åˆ°Actions Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: ComfyUI_Electron-Minimal-Win64
          path: |
            dist/**
          retention-days: 30